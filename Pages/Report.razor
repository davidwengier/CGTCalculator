@page "/report"
@inject DataSource Data
@using Microsoft.AspNetCore.Components.QuickGrid

<Nav ShowHome="true" Title="Report" />

<MudBlazor.MudTabs ActivePanelIndex="@(HasOpen ? 1 : 0)">
    @if (HasOpen)
    {
        <MudBlazor.MudTabPanel Text="@_report.Open.TaxYear">
            <CgtSingleYearReport Report="_report.Open" />
        </MudBlazor.MudTabPanel>
    }
    @foreach (var report in _report.Reports)
    {
        <MudBlazor.MudTabPanel Text="@report.TaxYear">
            <CgtSingleYearReport Report="report" />
        </MudBlazor.MudTabPanel>
    }
</MudBlazor.MudTabs>

@code {
    private CgtReport _report = null!;

    private bool HasOpen => _report.Open.LineItems.Count > 0;

    protected override async Task OnInitializedAsync()
    {
        _report = await CgtReportCreator.CreateAsync(this.Data).ConfigureAwait(false);
    }
}
